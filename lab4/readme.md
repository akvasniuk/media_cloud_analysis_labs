# Audio Transcribe API

**Audio Transcribe** is an AWS Lambda + API Gateway solution for audio transcription, sentiment analysis, and phrase/topic detection using **Deepgram API** and NLP tools.

**Base URL:**  
https://{api_id}.execute-api.{region}.amazonaws.com/{stage}/

- `{stage}`: `prod` (default)
- `{api_id}`: auto-generated by CloudFormation / API Gateway

**Supported Audio Types:**
- `audio/wav`
- `audio/mpeg`
---

## **1. Generate Key**

**Endpoint:**  
***POST /generate-key***

**Description:**  
Generates a unique user token based on email. This token is required to upload audio and access transcript history.

**Request Body (JSON):**
```json
{
  "email": "user@example.com"
}
```
**Response:**

**200:**  
```json
{
  "token": "a1b2c3d4-uuid-token"
}
```

**400 Bad Request:**
```json
{
  "error": "Email required"
}
```

**500 Internal Server Error:**
```json
{
  "error": "Error description"
}
```

**Example (cURL):**
```bash
curl -X POST https://{api_id}.execute-api.{region}.amazonaws.com/prod/generate-key \
  -H "Content-Type: application/json" \
  -d '{"email": "user@example.com"}'
```

## **2. Transcribe Audio**

**Endpoint:**  
***POST /transcribe***

**Description:**  
Accepts an audio file and user token. Returns transcript, language, sentiment, phrase search results, and topics.

**Request:** multipart/form-data

| Field Name | Type            | Description                              |
|------------|----------------|------------------------------------------|
| token      | string          | User token obtained from /generate-key. Can also be passed as a query parameter `?token=...` |
| file       | file            | Audio file (wav or mp3)                  |
| phrase     | string (optional)| Phrase to search in the transcript       |

**Response:**

**200:**
```json
{
  "file_id": "uuid",
  "language": "en",
  "sentiment": {
    "compound": 0.34,
    "sentiment": "Positive"
  },
  "phrase_search": {
    "found": true,
    "text": "example",
    "start_char": 10,
    "end_char": 17
  },
  "topics": ["AI", "Machine Learning"],
  "transcript": "This is the transcribed text from audio..."
}
```

**400 Bad Request:**
```json
{
  "error": "Missing token"
}
```

**500 Internal Server Error:**
```json
{
  "error": "API error description"
}
```

**Example (cURL):**
```bash
# form-data
curl -X POST https://{api_id}.execute-api.{region}.amazonaws.com/prod/transcribe \
  -F "token=a1b2c3d4-uuid-token" \
  -F "file=@audio.wav" \
  -F "phrase=example"

# query parameter
curl -X POST "https://{api_id}.execute-api.{region}.amazonaws.com/prod/transcribe?token=a1b2c3d4-uuid-token" \
  -F "file=@audio.wav" \
  -F "phrase=example"
```
## **3. Get History**

**Endpoint:**  
***POST /history***

**Description:**  
Returns a list of all transcripts associated with a user token.


**Request:** token via query parameter

**Query Parameter:**
    `token` (string, required) â€” User token obtained from /generate-key

**Response:**

**200:**
```json
{
  "transcripts": [
    "a1b2c3d4_file1_audio.wav_analysis.txt",
    "a1b2c3d4_file2_audio.mp3_analysis.txt"
  ]
}
```

**400 Bad Request:**
```json
{
  "error": "Token required"
}
```

**404 Not Found**
```json
{
  "error": "User folder not found"
}
```
**500 Internal Server Error:**
```json
{
  "error": "API error description"
}
```

**Example (cURL):**
```bash
curl -X POST https://{api_id}.execute-api.{region}.amazonaws.com/prod/history \
  -H "Content-Type: application/json" \
  -d '{"token": "a1b2c3d4-uuid-token"}'
```

> **Notes**
>
> - All Lambda functions save audio files and analysis results to the S3 Bucket specified in the `ExistingBucketName` parameter.
> - Sentiment analysis is performed using NLTK VADER.
> - Language detection is performed using langid.
> - Topics and content understanding are extracted via Deepgram Read API.
> - Each token is unique for every email and is used for grouping user files.
